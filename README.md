# Family Photo Album 

Family Photo Album is a mobile-first web application for families to easily post photos for friends and family to enjoy. The platform features a simple, Instagram-like public photo stream that requires no login for viewers, while family members authenticate to upload photos.

An admin manages family access by entering the valid email addresses that can log in.

The goal is to create a frictionless photo sharing experience that encourages frequent uploads while maintaining full content ownership and control, avoiding the complexity and platform dependencies of existing social media or cloud photo services.

The project is built with PHP/Laravel so that it's possible to deploy on inexpensive shared hosting platforms.

## Features

- **Public Photo Stream**: Instagram-like feed accessible without login
- **Family Authentication**: Email-based registration for family members
- **Admin Controls**: Manage allowed email addresses and family members
- **Photo Management**: Upload, crop, and manage photos with automatic thumbnails
- **Mobile-First Design**: Optimized for mobile photo sharing
- **Security**: Built-in rate limiting, CSRF protection, and security headers
- **Shared Hosting Friendly**: Designed to work on affordable shared hosting

## Tech Stack

- **Laravel 12** - PHP Framework
- **Livewire** - Full-stack framework with Volt components
- **Flux UI** - Modern UI components
- **SQLite/MySQL** - Database (configurable)
- **Vite** - Asset building and hot reloading

## Quick Start

### Local Development

1. **Clone and install:**
   ```bash
   git clone https://github.com/jabbett/family-photo-album.git
   cd family-photo-album
   composer install
   npm install
   ```

2. **Setup environment:**
   ```bash
   cp .env.example .env
   php artisan key:generate
   touch database/database.sqlite
   php artisan migrate
   php artisan storage:link
   ```

3. **Start development:**
   ```bash
   composer run dev
   ```

### Admin Setup

After first deployment, promote a user to admin:

```bash
php artisan tinker
>>> User::where('email', 'your@email.com')->first()->update(['admin' => true]);
```

## Production Setup

### HTTPS

This app enforces HTTPS in production and is proxy-aware. Development remains unchanged.

#### Environment variables to set in production

- APP_URL=https://yourdomain.example
- TRUSTED_PROXIES="*"  # or a comma-separated list / CIDRs of your proxy IPs
- SESSION_SECURE_COOKIE=true

#### Reverse proxy / load balancer requirements

- Forward these headers to the app:
  - X-Forwarded-Proto
  - X-Forwarded-Host
  - X-Forwarded-Port
  - X-Forwarded-For
  - X-Forwarded-Prefix (if you mount under a sub-path)

#### Behavior

- HTTPâ†’HTTPS 301 redirects in production
- HSTS header: `Strict-Transport-Security: max-age=31536000; includeSubDomains`
- URLs generated by the app use https when `APP_URL` is https

#### Optional

- To enable HSTS preload, append `; preload` to the HSTS header and submit your domain to the preload list when ready.

#### After deployment

```
php artisan config:clear
php artisan route:clear
```

### Configuration

You can tune rate limiting and feed pagination via environment variables:

- FEED_PER_MINUTE: Max requests per minute to `GET /photos/feed` (default: 60)
- SHOW_PER_MINUTE: Max requests per minute to `GET /photo/{photo}` (default: 120)
- DOWNLOADS_PER_MINUTE: Max requests per minute to `GET /photo/{photo}/download` (default: 30)
- FEED_MAX_PER_PAGE: Max items per page for feed pagination (default: 50)
- FEED_MAX_PAGE: Maximum allowed page number for feed pagination (default: 1000)

Optional (proxy / cookie security):

- TRUSTED_PROXIES: Comma-separated list or CIDRs of trusted proxies (optional; set when behind a proxy)
- SESSION_SECURE_COOKIE: Set to `true` in production to mark session cookies as Secure
- SESSION_SAME_SITE: SameSite policy for cookies; recommended `lax` (or `strict` if you don't need cross-site flows)
- SESSION_DOMAIN: Your cookie domain (e.g., `yourdomain.example`), or `.yourdomain.example` if you need subdomains

### Security headers

This app sets production-only security headers via middleware. If you change external assets (CDNs) or embedding needs, update the policy accordingly.

- Content-Security-Policy (CSP):
  - default-src 'self'
  - script-src 'self' https://cdn.tailwindcss.com
  - style-src 'self' https://fonts.bunny.net 'unsafe-inline'
  - font-src 'self' https://fonts.bunny.net
  - img-src 'self' data: blob:
  - connect-src 'self'
  - frame-ancestors 'none' (change to 'self' if you must allow embedding)
- Referrer-Policy: same-origin
- X-Content-Type-Options: nosniff
- X-Frame-Options: DENY (redundant with frame-ancestors)
- Permissions-Policy: camera=(), microphone=(), geolocation=(), payment=(), usb=(), accelerometer=(), gyroscope=(), magnetometer=(), interest-cohort=()
- Cross-Origin-Resource-Policy: same-site
- Cross-Origin-Opener-Policy: same-origin

Guidance for future changes (AI-friendly):
- If you add a new CDN for scripts, append its origin to `script-src`.
- If you host styles/fonts locally, you can remove external origins from `style-src` and `font-src`.
- If you need to allow embedding this site in an iframe, change `frame-ancestors` to `'self'` or a specific origin list.

